yabai -m signal --add event=dock_did_restart action="sudo yabai --load-sa"
sudo yabai --load-sa

## Disabled global settings
# yabai -m config                                 \
# -  mouse_follows_focus          off            \
# -  focus_follows_mouse          off            \

# global settings
yabai -m config                                 \
    mouse_follows_focus          off             \
    focus_follows_mouse          off      \
    window_origin_display        default        \
    window_placement             second_child   \
    window_topmost               off            \
    window_shadow                on             \
    window_animation_duration    0.0            \
    window_opacity_duration      0.0            \
    active_window_opacity        1.0            \
    normal_window_opacity        0.90           \
    window_opacity               off            \
    insert_feedback_color        0xffd75f5f     \
    active_window_border_color   0xff52caeb     \
    normal_window_border_color   0x00555555     \
    window_border_width          4              \
    window_border_radius         12             \
    window_border_blur           off            \
    window_border_hidpi          on             \
    window_border                on             \
    split_ratio                  0.50           \
    split_type                   auto           \
    auto_balance                 on             \
    top_padding                  25             \
    bottom_padding               5              \
    left_padding                 5              \
    right_padding                5              \
    window_gap                   02             \
    layout                       bsp            \
    mouse_modifier               ctrl           \
    mouse_action1                move           \
    mouse_action2                resize         \
    mouse_drop_action            swap           
    
#    debug_output                 

# Named spaces
function setup_space {
    local idx="$1"
    local name="$1_$2"
    local space=""
    echo "setup space $idx : $name"

    space=$(yabai -m query --spaces --space "$idx")
    if [ -z "$space" ]; then
        yabai -m space --create
    fi

    yabai -m space "$idx" --label "$name"
}

# yabai -m space 1 --label space_iterm
# yabai -m space 2 --label space_unk2
# yabai -m space 3 --label space_radar


setup_space 01  space_iterm
setup_space 02  space_notes
setup_space 03  space_radar
setup_space 04  space_calendar
setup_space 05  space_monitor
setup_space 06  space_docs
setup_space 07  space_mail
setup_space 08  space_chrome
setup_space 09  space_safari
setup_space 10 space_music
setup_space 11 space_code
setup_space 12 space_xcode
setup_space 13 space_finder
setup_space 14 space_ptb
setup_space 15 space_webex
setup_space 16 space_logs
setup_space 17 space_unk17
setup_space 18 space_unk18
setup_space 19 space_slack
setup_space 20 space_whatsapp


# Named displays
# Built in display
disp_ex1=$(yabai -m query --displays | jq 'map(select(.frame.x = 0))[0].index')
disp_ex2=$(yabai -m query --displays | jq 'map(select(.frame.x > 0))[0].index')
disp_mbp=$(yabai -m query --displays | jq 'map(select(.frame.x < 0))[0].index')
# disp_mbp=$(yabai -m query --displays | jq 'map(select(.frame.w < 2500))[0].index')
# disp_mbp=$(yabai -m query --displays | jq 'map(select(.frame.w < 2500))[0].index')
# disp_ex1=$(yabai -m query --displays | jq 'map(select(.id == 1))[0].index')
# disp_ex2=$(yabai -m query --displays | jq 'map(select(.id == 1))[0].index')
# disp_mpb=$(yabai -m query --displays | jq 'map(select(.id != 1))[0].index')

# yabai -m display $(yabai -m query --displays | jq 'map(select(.id == 1))[0].index') --label disp_mbp
# yabai -m display $(yabai -m query --displays | jq 'map(select(.id != 1))[0].index') --label disp_ex1
# yabai -m display $(yabai -m query --displays | jq 'map(select(.id != 1))[-1].index') --label disp_ex2


# Move displays to right monitors
yabai -m space 01_space_iterm       --display $disp_ex2 &
yabai -m space 02_space_notes       --display $disp_mbp &
yabai -m space 03_space_radar       --display $disp_ex1 &
yabai -m space 04_space_calendar    --display $disp_ex2 &
yabai -m space 05_space_monitor     --display $disp_mbp &
yabai -m space 08_space_chrome      --display $disp_ex1 &
yabai -m space 09_space_safari      --display $disp_ex1 &
yabai -m space 10_space_music       --display $disp_mbp &
yabai -m space 11_space_code        --display $disp_ex1 &
yabai -m space 12_space_xcode       --display $disp_ex1 &
yabai -m space 13_space_finder      --display $disp_ex2 &
yabai -m space 16_space_logs        --display $disp_ex1 &
yabai -m space 17_space_unk17       --display $disp_mbp &
yabai -m space 19_space_slack       --display $disp_mbp &
yabai -m space 20_space_whatsapp    --display $disp_mbp &

# Assign apps to spaces
yabai -m rule --add app="^iTerm"        space=01_space_iterm
yabai -m rule --add app="^Notes$"       space=02_space_notes
yabai -m rule --add app="^Typora$"      space=02_space_notes
yabai -m rule --add app="^Radar$"       space=03_space_radar
yabai -m rule --add app="^Calendar$"    space=04_space_calendar
yabai -m rule --add app="Monitor$"      space=05_space_monitor

yabai -m rule --add app="Preview"       space=06_space_docs
yabai -m rule --add app="Word"          space=06_space_docs
yabai -m rule --add app="Numbers"       space=06_space_docs
yabai -m rule --add app="Excel"         space=06_space_docs
yabai -m rule --add app="Omni"          space=06_space_docs
yabai -m rule --add app="Keynote"       space=06_space_docs

yabai -m rule --add app="Webex"         space=15_space_webex
yabai -m rule --add app="Mail"          space=07_space_mail
yabai -m rule --add app="Chrome"        space=08_space_chrome
yabai -m rule --add app="Edge"          space=08_space_chrome
yabai -m rule --add app="^Safari$"      space=09_space_safari
yabai -m rule --add app="YouTube"       space=10_space_music
yabai -m rule --add app="^Code$"        space=11_space_code
yabai -m rule --add app="^PyCharm$"     space=11_space_code
yabai -m rule --add app="Xcode"         space=12_space_xcode
yabai -m rule --add app="Finder"        space=13_space_finder
yabai -m rule --add app="Purple"        space=14_space_ptb
yabai -m rule --add app="Glide"         space=16_space_logs
yabai -m rule --add app="^Slack$"       space=19_space_slack
yabai -m rule --add app="^WhatsApp$"    space=20_space_whatsapp
yabai -m rule --add app="CopyQ"         manage=off

yabai -m space 16_space_logs            --layout stack
yabai -m space 12_space_xcode           --layout stack
yabai -m space 11_space_code            --layout stack


echo "yabai configuration loaded.."

echo "Reloading sketchybar"
sketchybar --remove '/.*/'                                                                                                                                                                                    ─╯
source $HOME/.config/sketchybar/sketchybarrc
